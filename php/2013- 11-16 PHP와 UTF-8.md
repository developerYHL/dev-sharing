# PHP와 UTF-8
- Type: 세미나
- Tags: PHP Best Practice
- Author: 박충-

미안하지만, PHP의 UTF-8은 병맛이다.

현재 PHP는 낮은 수준에서 유니코드를 지원하지 않는다. UTF-8 문자열을 처리하기 위한 방법들은 있지만, 쉽지 않고, HTML에서 SQL, PHP까지 웹 프로그램의 거의 모든 수준을 파야 가능하다. 여기에서는 개요에 집중하기 위해 실질적인 요약만 해 둔다.

## PHP 층위에서의 UTF-8

두 문자열을 연결하거나 변수를 할당한 문자열처럼, 기본 문자열 활용에 있어서는 별거 없다. 반면에 strpos()이나 strlen()같은 대부분의 문자열 함수들은 특별한 고려가 필요하다. mb_어쩌고 하는 함수들도 있다(예: mb_strpos(), mb_strlen()). 이런 함수들을 멀티 바이트 문자열 함수라고 부른다. 이 멀티 바이트 문자열 함수들은 유니코드 문자열을 다루기 위해 만들었다.

유니코드 문자열을 다룰 때는 반드시 mb_어쩌고 하는 함수들을 써야 한다. 예컨대 UTF-8 문자열에 substr()을 쓴다면 문자열이 꺠진다. 멀티 바이트 문자열에 맞는 함수는 mb_substr()이다.

난점은 mb_어쩌고 하는 함수들을 사용하는걸 매번 떠올리는 일이다. 한 번이라도 까먹으면 당신의 유니코드 문자열은 작살날거다.

덧붙이자면, 모든 PHP 코드들 맨 위에 mb_internal_encoding() 함수를 써주거나 인클루드해줘야하고, 브라우저에 코드를 출력할거면 mb_http_output() 함수를 그 다음에 붙여줘야 한다. 모든 코드의 문자열을 명쾌하게 정의하는게 머리가 덜 아플거다.

마지막으로, 문자열을 다루는 많은 PHP 함수들은 구체적인 문자 인코딩을 추가적인 인자값으로 요한다.

## MySQL 층위에서의 UTF-8

PHP 코드가 MySQL에 접근할 때, 모든 예방 조치에 따랐음에도 당신의 문자열이 DB에 비 UTF-8 문자열로 저장될 수 있다.

당신의 문자열이 PHP에서 MySQL로 갈 때 UTF-8로 확실히 가기 위해, 당신의 DB와 테이블들을 utf8mb4 문자열로 확실히 설정해야 한다. 완벽한 UTF-8 지원을 위해 반드시 utf8mb4 캐릭터 셋을 사용해야 한다는걸 명심하자. UTF-8 캐릭터 셋이 아니다!. 왜 그런지는 더 읽을거리를 참고하라.

## 브라우저 층위에서의 UTF-8

PHP 코드가 UTF-8 문자열을 브라우저에 출력하게 하기 위해 mb_http_output() 함수를 사용해야 한다. HTML 페이지의 <head> 태그 안에 <meta> 태그를 써서 캐릭터 셋을 해라.
